<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance Clone - Trade</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="config.js"></script>
    <script src="db.js"></script>
    <script src="auth.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-chart-line"></i></div>
                <div class="logo-text">BINANCE</div>
                <div class="logo-demo">DEMO</div>
            </div>
            
            <nav class="nav-main">
                <a href="index.html" class="nav-link active"><i class="fas fa-exchange-alt"></i> Trade</a>
                <a href="assets.html" class="nav-link"><i class="fas fa-wallet"></i> Assets</a>
                <a href="orders.html" class="nav-link"><i class="fas fa-list"></i> Orders</a>
                <a href="history.html" class="nav-link"><i class="fas fa-history"></i> History</a>
            </nav>
            
            <div class="header-actions">
                <div class="balance-display">
                    <div class="balance-item">
                        <span class="balance-label">EUR:</span>
                        <span class="balance-value" id="eur-balance">€400.00</span>
                    </div>
                    <div class="balance-item">
                        <span class="balance-label">BTC:</span>
                        <span class="balance-value" id="btc-balance">0.500000</span>
                    </div>
                </div>
                
                <div class="user-menu" id="user-menu">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <div class="user-info">
                        <div class="user-email" id="user-email">user@demo.com</div>
                        <div class="user-status">Online</div>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Sidebar - Markets -->
            <div class="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">Watchlist</div>
                    <div class="market-list" id="watchlist">
                        <!-- Watchlist loaded here -->
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">Markets</div>
                    <div class="market-search">
                        <input type="text" placeholder="Search markets..." id="market-search">
                    </div>
                    <div class="market-list" id="market-list">
                        <!-- All markets loaded here -->
                    </div>
                </div>
            </div>

            <!-- Trading Area -->
            <div class="trading-area">
                <!-- Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="pair-info">
                            <div class="pair-name" id="current-pair">BTC/EUR</div>
                            <div class="price-info">
                                <div class="current-price" id="current-price">€0.00</div>
                                <div class="price-change positive" id="price-change">+0.00%</div>
                            </div>
                        </div>
                        <div class="chart-controls">
                            <button class="time-interval" data-interval="1">1m</button>
                            <button class="time-interval" data-interval="5">5m</button>
                            <button class="time-interval active" data-interval="15">15m</button>
                            <button class="time-interval" data-interval="60">1h</button>
                            <button class="time-interval" data-interval="240">4h</button>
                            <button class="time-interval" data-interval="1D">1D</button>
                            <button class="time-interval" data-interval="1W">1W</button>
                        </div>
                    </div>
                    <div id="tradingview-chart"></div>
                </div>

                <!-- Order Book & Recent Trades -->
                <div class="bottom-panel">
                    <div class="panel-tabs">
                        <button class="panel-tab active" data-panel="orderbook">Order Book</button>
                        <button class="panel-tab" data-panel="trades">Recent Trades</button>
                        <button class="panel-tab" data-panel="open-orders">Open Orders</button>
                    </div>
                    <div class="panel-content">
                        <!-- Order Book -->
                        <div class="order-book" id="orderbook-panel">
                            <div class="order-book-header">
                                <span>Price (EUR)</span>
                                <span>Amount</span>
                                <span>Total</span>
                            </div>
                            <div class="order-book-rows" id="order-book">
                                <!-- Order book loaded here -->
                            </div>
                        </div>
                        
                        <!-- Recent Trades -->
                        <div class="recent-trades hidden" id="trades-panel">
                            <div class="trades-header">
                                <span>Price</span>
                                <span>Amount</span>
                                <span>Time</span>
                            </div>
                            <div class="trades-list" id="recent-trades">
                                <!-- Recent trades loaded here -->
                            </div>
                        </div>
                        
                        <!-- Open Orders -->
                        <div class="open-orders hidden" id="open-orders-panel">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Pair</th>
                                        <th>Side</th>
                                        <th>Price</th>
                                        <th>Amount</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="open-orders">
                                    <!-- Open orders loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar - Order Form -->
            <div class="order-form-container">
                <div class="order-tabs">
                    <button class="order-tab active" data-type="limit">Limit</button>
                    <button class="order-tab" data-type="market">Market</button>
                    <button class="order-tab" data-type="stop">Stop-Limit</button>
                </div>
                
                <div class="order-form">
                    <div class="form-group">
                        <label>Price (EUR)</label>
                        <input type="number" id="order-price" class="form-input" step="0.01" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label>Amount</label>
                        <div class="input-group">
                            <input type="number" id="order-amount" class="form-input" step="0.000001" placeholder="0.00">
                            <span class="input-suffix" id="pair-base">BTC</span>
                        </div>
                        <div class="percent-buttons">
                            <button class="percent-btn" data-percent="25">25%</button>
                            <button class="percent-btn" data-percent="50">50%</button>
                            <button class="percent-btn" data-percent="75">75%</button>
                            <button class="percent-btn" data-percent="100">100%</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Total (EUR)</label>
                        <div class="input-group">
                            <input type="number" id="order-total" class="form-input" step="0.01" placeholder="0.00">
                            <span class="input-suffix">EUR</span>
                        </div>
                    </div>
                    
                    <div class="order-summary">
                        <div class="summary-row">
                            <span>Fee (Taker)</span>
                            <span id="order-fee">€0.00</span>
                        </div>
                        <div class="summary-row">
                            <span>Available</span>
                            <span id="buy-balance">€400.00 EUR</span>
                        </div>
                    </div>
                    
                    <div class="order-buttons">
                        <button class="order-btn buy" id="buy-btn">Buy BTC</button>
                        <button class="order-btn sell" id="sell-btn">Sell BTC</button>
                    </div>
                </div>
                
                <div class="balance-info">
                    <div class="balance-row">
                        <span>Available to sell:</span>
                        <span id="sell-balance">0.500000 BTC</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Initialize user info
        document.addEventListener('DOMContentLoaded', function() {
            const user = auth.getUser();
            if (user) {
                document.getElementById('user-email').textContent = user.email;
                document.getElementById('user-avatar').textContent = user.email.charAt(0).toUpperCase();
            }
            
            // Panel switching
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const panel = this.dataset.panel;
                    
                    // Update active tab
                    document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show selected panel
                    document.getElementById('orderbook-panel').classList.add('hidden');
                    document.getElementById('trades-panel').classList.add('hidden');
                    document.getElementById('open-orders-panel').classList.add('hidden');
                    document.getElementById(panel + '-panel').classList.remove('hidden');
                });
            });
            
            // User menu dropdown
            document.getElementById('user-menu').addEventListener('click', function() {
                const menu = document.createElement('div');
                menu.style.cssText = `
                    position: absolute;
                    top: 60px;
                    right: 20px;
                    background: var(--bg-card);
                    border: 1px solid var(--border);
                    border-radius: 8px;
                    padding: 8px;
                    min-width: 200px;
                    z-index: 1000;
                `;
                menu.innerHTML = `
                    <div style="padding: 8px 12px; cursor: pointer; border-radius: 4px;" 
                         onmouseover="this.style.background='var(--bg-hover)'"
                         onmouseout="this.style.background='transparent'">
                        <i class="fas fa-user"></i> Profile
                    </div>
                    <div style="padding: 8px 12px; cursor: pointer; border-radius: 4px;" 
                         onmouseover="this.style.background='var(--bg-hover)'"
                         onmouseout="this.style.background='transparent'">
                        <i class="fas fa-cog"></i> Settings
                    </div>
                    <div style="padding: 8px 12px; cursor: pointer; border-radius: 4px; color: var(--red);" 
                         onmouseover="this.style.background='var(--bg-hover)'"
                         onmouseout="this.style.background='transparent'"
                         onclick="auth.logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </div>
                `;
                document.body.appendChild(menu);
                
                // Remove menu on outside click
                const removeMenu = (e) => {
                    if (!menu.contains(e.target) && !this.contains(e.target)) {
                        menu.remove();
                        document.removeEventListener('click', removeMenu);
                    }
                };
                setTimeout(() => document.addEventListener('click', removeMenu), 0);
            });
        });
    </script>
</body>
</html>
